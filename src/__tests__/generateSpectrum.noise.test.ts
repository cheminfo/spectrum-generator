import { toBeDeepCloseTo, toMatchCloseTo } from 'jest-matcher-deep-close-to';
import { describe, it, expect } from 'vitest';

import { generateSpectrum } from '../SpectrumGenerator';

expect.extend({ toBeDeepCloseTo, toMatchCloseTo });

describe('generateSpectrum with noise', () => {
  it('derivative should be continuous', () => {
    const spectrum = generateSpectrum([{ x: 5, y: 100 }], {
      generator: {
        from: 0,
        to: 10,
        nbPoints: 51,
        peakWidthFct: () => 2,
      },
      noise: {
        percent: 10,
        distribution: 'uniform',
      },
    });
    expect(spectrum.y).toBeDeepCloseTo([
      -3.528188467025757, -2.1459490060806274, 1.3001924753189087,
      -1.3008952140808105, 1.3622105121612549, 1.3711363077163696,
      0.5794413437798801, 3.1984429187595347, 3.3140519340349774,
      -2.5535263109341404, 0.15932977199554443, -3.222454608197802,
      1.3716362125807502, 0.9822406782971791, 2.5613518896437193,
      9.790646433830261, 8.096611650655861, 19.537452927324427,
      27.598712060444637, 35.71801170802676, 54.393686056137085,
      66.35175854982948, 82.36694009610066, 91.50592828019809, 97.3766001832757,
      100.86471617221832, 98.32318452718587, 91.12810695394224,
      79.03717787571793, 64.77978439154238, 48.55413258075714,
      41.72474131084045, 28.079936716549657, 18.449881544801812,
      12.368282230566118, 7.455530166625977, -0.5826137122773662,
      -1.0111371264589872, 0.7477841980391216, 1.2711687676948358,
      -4.740967750549316, -1.9974781561032082, -0.6754365484403034,
      0.40921734045142905, 4.601220046515781, -1.1780953407287598,
      2.5263625383377075, -2.1484696865081787, 0.02783656120300293,
      -2.3277217149734497, -0.5248445272445679,
    ]);
  });
});
